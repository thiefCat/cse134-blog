<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form</title>
    <link rel="stylesheet" href="form.css">
    <script src="theme.js" defer></script>
    <style>
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('name');
            const errorOutput = document.querySelector('.error-message');

            const illegalNamePattern = /[^a-zA-Z\s-]/;

            nameInput.addEventListener('input', (event) => {
                if (illegalNamePattern.test(nameInput.value)) {
                    nameInput.classList.add('field-flash');

                    errorOutput.textContent = "Name: Only letters, spaces, and hyphens allowed.";
                    nameInput.setCustomValidity("Invalid characters detected.");
                    setTimeout(() => {
                        errorOutput.textContent = "";
                        nameInput.classList.remove('field-flash');
                    }, 2000);
                } else {
                    nameInput.setCustomValidity("");
                }
            });

            const commentsInput = document.getElementById('comments');
            const maxLength = commentsInput.getAttribute('maxlength');
            const infoOutput = document.querySelector('.info-message');
            commentsInput.addEventListener('input', () => {
                const currentLength = commentsInput.value.length;
                const remaining = maxLength - currentLength;
                infoOutput.textContent = `Comments: ${remaining} chars remaining`;
                if (remaining <= 20) { 
                    infoOutput.classList.add('count-warning');
                } else {
                    infoOutput.classList.remove('count-warning', 'count-error');
                }
            });

            let form_errors = [];
            const formErrorsField = document.getElementById('form-errors');
            const allFields = document.querySelectorAll('input, textarea');
            allFields.forEach(field => {
                field.addEventListener('invalid', (event) => {
                    console.log("err!!")
                    const errorData = {
                        field: field.name,
                        reason: field.validationMessage,
                        value: field.value
                    };

                    form_errors.push(errorData);
                    formErrorsField.value = JSON.stringify(form_errors);
                });
            });
        })
    </script>
</head>

<body>
    <button id="theme-toggle" type="button">Switch Mode</button>

    <noscript>
        <style>
            .noscript-msg { display: block; color: red; padding: 1rem; }
        </style>
        <div class="noscript-msg">
            JavaScript is required to switch themes.
        </div>
    </noscript>

    <form action="https://httpbin.org/post" method="POST">
        
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required minlength="2" pattern="[a-zA-Z \-]+" title="Please enter letters, spaces, or hyphens only (min 2 characters).">

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required pattern="^[^@\s]+@[^@\s]+\.[^@\s]+$" title="Please enter a valid email address">

        <label for="comments">Comments:</label>
        <textarea id="comments" name="comments" rows="5" required maxlength="100"></textarea>

        <input type="hidden" name="possible_bot" value="true">
        <input type="hidden" name="form-errors" id="form-errors">

        <button type="submit">Send Message</button>

        <output class="error-message"></output>
        <output class="info-message"></output>
    </form>

</body>
</html>